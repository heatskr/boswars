<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<!--
----	(c) Copyright 2004-2007 by Russell Smith

----    This program is free software; you can redistribute it and/or modify
----    it under the terms of the GNU General Public License as published by
----    the Free Software Foundation; only version 2 of the License.
----
----    This program is distributed in the hope that it will be useful,
----    but WITHOUT ANY WARRANTY; without even the implied warranty of
----    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
----    GNU General Public License for more details.
----
----    You should have received a copy of the GNU General Public License
----    along with this program; if not, write to the Free Software
----    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
----    02111-1307, USA.
-->
    <title>Bos Wars Scripting API: Save Game Files</title>
    <meta http-equiv="Content-Type" content="text/html; CHARSET=iso-8859-1">
</head>
<body>
    <h1>Bos Wars Scripting API: Save Game Files</h1>
<hr>
<a href="../index.html">Bos Wars</a> 
<a href="../faq.html">FAQ</a> 
<a href="limits.html">PREV</a> 
<a href="sound.html">NEXT</a> 
<a href="index.html">LUA Index</a>
<hr>
<a href="#DefineAiPlayer">DefineAiPlayer</a>
<a href="#Missile">Missile</a>
<a href="#SaveGame">SaveGame</a>
<a href="#SlotUsage">SlotUsage</a>
<hr>
<h2>Intro - Introduction to savegame functions and variables</h2>

Everything around save games. All of the functions below are primarily used
in the creation and loading of saved games.
The engine generates calls to these functions when it saves a game.
When the saved game is loaded back, those calls restore its state.

<h2>Functions</h2>

<a name="DefineAiPlayer"></a>
<h3>DefineAiPlayer(player-number, properties)</h3>

<p>Define an AI player. Saved games use this function;
map setup files should not.</p>

<dl>
  <dt>player-number</dt>
  <dd>
    Number of the player, counting from 0.
  </dd>
  <dt>properties</dt>
  <dd>
    Properties of the AI player.
    This list consists of tags and associated values.
    These tags are available:
    <dl>
      <dt>"ai-type", string</dt>
      <dd>
	Name of the AI type.  Matches the name (not class) parameter
	of <a href="#DefineAi">DefineAi</a>.
      </dd>
      <dt>"script", string</dt>
      <dd>
	Name of the AI script function in the "_ai_scripts_" Lua table.
	<a href="#DefineAi">DefineAi</a> generates this name.
      </dd>
      <dt>"script-debug", boolean</dt>
      <dd>
	<em>Obsolete since r5923 (2004-01-01):
	  The debug flag no longer affects the engine,
	  and scripts cannot read it.</em><br>

	Whether to display the executed AI script commands.
	The <a href="#AiDebug">AiDebug</a>
	and <a href="#AiDebugPlayer">AiDebugPlayer</a>
	functions also control this flag.
      </dd>
      <dt>"sleep-cycles", integer</dt>
      <dd>
	The number of the game cycle on which the AI will wake up
	from <a href="#AiSleep">AiSleep</a>, or 0 if not sleeping.
      </dd>
      <dt>"force", {force, properties}</dt>
      <dd>
	Defines a group of units that should attack or defend together,
	to overwhelm the enemy.
	The value must be a list that contains two elements:
	<dl>
	  <dt>force</dt>
	  <dd>
	    Number of the force.  0 - 9 is currently supported.
	  </dd>
	  <dt>properties</dt>
	  <dd>
	    Properties of the force.
	    This list consists of subtags and possibly values.
	    Some subtags do not allow a value and the others require a value.
	    These subtags are available:
	    <dl>
	      <dt>"complete"</dt>
	      <dd>
		The force does not need more units.
		This is the opposite of "recruit".
	      </dd>
	      <dt>"recruit"</dt>
	      <dd>
		The force needs more units.
		This is the opposite of "complete".
	      </dd>
	      <dt>"attack"</dt>
	      <dd>
		The force is attacking.
	      </dd>
	      <dt>"defend"</dt>
	      <dd>
		The force is defending a unit that was attacked.
		After the enemies are dead, the force should return home.
	      </dd>
	      <dt>"role", string</dt>
	      <dd>
		<em>Obsolete since r5923 (2004-01-01):
		  Roles of forces no longer affect the engine,
		  and scripts cannot read them.</em><br>
		The role of the force, as set with
		<a href="#AiForceRole">AiForceRole</a>.
	      </dd>
	      <dt>"types", {[count, unit-type-name]...}</dt>
	      <dd>
		How many of each unit type should be in the force.
		This is set with <a href="#AiForce">AiForce</a>.
	      </dd>
	      <dt>"units", {[unit-number, unit-type-name]...}</dt>
	      <dd>
		List of units currently in the force.
		The type names are ignored on load.
	      </dd>
	      <dt>"state", integer</dt>
	      <dd>
		Attack state.
	      </dd>
	      <dt>"goalx", integer</dt>
	      <dd>
		Attack point X tile map position.
	      </dd>
	      <dt>"goaly", integer</dt>
	      <dd>
		Attack point Y tile map position.
	      </dd>
	    </dl>
	  </dd>
	</dl>
      <dt>"needed", {[resource-type-name, amount]...}</dt>
      <dd>
	FIXME
      </dd>
      <dt>"need-mask", {resource-type-name...}</dt>
      <dd>
	FIXME
      </dd>
      <dt>"last-can-not-move-cycle", integer</dt>
      <dd>
	FIXME
      </dd>
      <dt>"unit-type", {[unit-type-name, count]...}</dt>
      <dd>
	FIXME
      </dd>
      <dt>"building", {[unit-type-name, made, want]...}</dt>
      <dd>
	FIXME
      </dd>
      <dt>"repair-building", integer</dt>
      <dd>
	FIXME
      </dd>
      <dt>"repair-workers", {[building-unit-number, count]...}</dt>
      <dd>	
	Number of workers that failed trying to repair a building.
      </dd>
    </dl>
  </dd>
</dl>

<p>For an example of DefineAiPlayer, please look in any save file.
No example is provided in this document because Lua scripts for maps
should not call DefineAiPlayer.</p>

<a name="Missile"></a>
<h3>Missile(<var>tag</var>, <var>value</var>, <var>tag</var>, <var>value</var>, ...)</h3>

<p>Adds a missile on the map.</p>

<p>The function supports these tag-value pairs:</p>

<dl>
  <dt>"type", <var>missile-type-name</var></dt>
  <dd>The type of the missile. Declared with
    <a href="magic.html#DefineMissileType">DefineMissileType</a>.</dd>
  <dt>"local"</dt>
  <dd>This missile is marked as local, and it's visible only to the player.
    This is used for instance for cursor marks on the map.
    The "local" tag is unusual in that no value follows it.
    Either "local" or "global" must be specified.</dd>
  <dt>"global"</dt>
  <dd>This missile is marked as global, and it's visible to all players.
    The "global" tag is unusual in that no value follows it.
    Either "local" or "global" must be specified.</dd>
  <dt>"pos", {<var>x</var>, <var>y</var>}</dt>
  <dd>The current position of the missile.
    Coordinates are in pixels, not tiles.
    For example: "pos", {4500, 3450}</dd>
  <dt>"origin-pos", {<var>x</var>, <var>y</var>}</dt>
  <dd>The starting position of the missile.
    Coordinates are in pixels, not tiles.
    For example: "origin-pos", {4505, 3455}</dd>
  <dt>"goal", {<var>x</var>, <var>y</var>}</dt>
  <dd>The position of the missile's destination.
    Coordinates are in pixels, not tiles.
    For example: "goal", {4510, 3460}</dd>
  <dt>"frame", <var>integer</var></dt>
  <dd>Current sprite frame of the missile; complicated behavior.
    A negative <var>integer</var> generally means the actual
    frame number is -1 - <var>integer</var> and the sprite
    should be mirrored in the X direction; but the effect depends
    on <a href="magic.html#DefineMissileType.Flip">the Flip parameter
      of DefineMissileType</a>.</dd>
  <dt>"state", <var>integer</var></dt>
  <dd>Current state of the missile.  Used for a simple state machine,
    dependand on the missile class.</dd>
  <dt>"anim-wait", <var>integer</var></dt>
  <dd>FIXME: Document this.</dd>
  <dt>"wait", <var>integer</var></dt>
  <dd>Wait this number of game cycles until the next state or animation
    of this missile is handled. This counts down from
    <a href="magic.html#DefineMissileType.Sleep">the Sleep parameter
      of DefineMissileType</a> to 0.</dd>
  <dt>"delay", <var>integer</var></dt>
  <dd>Number of game cycles left until the missile is first shown on the map.
    Please see <a href="magic.html#DefineMissileType.Delay">Delay in DefineMissileType</a>.</dd>
  <dt>"source", <var>unit-reference-string</var></dt>
  <dd>Number of the owner of the missile. Normally the one who fired the missile.
    Used to check units, to prevent hitting the owner. Also used for kill and
    experience points, and for giving the owning player score.</dd>
  <dt>"target", <var>unit-reference-string</var></dt>
  <dd>Number of the missile's target. Normally the unit which should be
    hit by the missile.</dd>
  <dt>"damage", <var>integer</var></dt>
  <dd>Damage done by missile. Units next to it can receive some reduced splash
    damage, this is the full damage.</dd>
  <dt>"ttl", <var>integer</var></dt>
  <dd>Time to live in game cycles of the missile, if it reaches zero
    the missile is automatically removed from the map. If -1 the
    missile lives for ever and the lifetime is handled by other means.</dd>
  <dt>"hidden"</dt>
  <dd>This marks the missile as hidden, until the
    <a href="magic.html#DefineMissileType.Class">missile class</a>
    decides to show it again.
    The "hidden" tag is unusual in that no value follows it.</dd>
  <dt>"step", {<var>current-step-integer</var>, <var>total-step-integer</var>}</dt>
  <dd>The progress of the missile along its movement path.
    Generally, <var>current-step-integer</var> starts
    from zero when the missile is launched, and it then
    increases until it reaches <var>total-step-integer</var>,
    at which point the missile hits its target.
    <a href="magic.html#DefineMissileType.Speed">The Speed parameter
      of DefineMissileType</a> is the rate of increase,
    and the value of <var>total-step-integer</var> is the distance
    between the source and the target.
    However, some missile classes may use these values differently.</dd>
</dl>

<h4>Example</h4>

<pre>
Missile("type", "missile-small-fire", "global", "pos", {1168, 1960}, "origin-pos", {1168, 1960}, "goal", {-16, -24},
  "frame", 0, "state", 0, "anim-wait", 0, "wait", 8, "delay", 0,
  "source", "U003B", "damage", 0, "ttl", -1, "step", {0, 0})
</pre>

<a name="SaveGame"></a>
<h3>SaveGame({SyncHash = x, SyncRandSeed = y, SaveFile = "file"})</h3>

Basic outline of the savegame, include hashs for syncrand and where to load
the rest of the game information from when loading. More information is planed
for implementation, but currently only the above are used.

<dl>
<dt>SyncHash = x</dt>
<dd>integer setting the Hash of the current game for Sync Purposes</dd>
<dt>SyncRandSeed = y</dt>
<dd>integer of the next value to be used when calling SyncRand</dd>
<dt>SaveFile = "file"</dt>
<dd>String containing the name of the file to load to get the rest of the gamedata</dd>
</dl>

<h4>Example</h4>

<pre>
SaveGame({
---  "comment", "Generated by Stratagus Version 2.0",
---  "comment", "Visit http://Stratagus.Org for more informations",
---  "type",    "single-player",
---  "date",    "Mon May 10 19:19:38 2004",
---  "map",     "",
---  "media-version", "Undefined"---  "engine",  {2, 0, 0},
     SyncHash = 196009203,
     SyncRandSeed = -220040269,
     SaveFile = "data.wc2//campaigns/human/level13h.cm"

---  "preview", "/home/devil/.stratagus/wc2/save/current-game.sav.pam",
} )
</pre>

<a name="SlotUsage"></a>
<h3>SlotUsage(MaxSlot, [{Slot = Slot1, FreeCycle = Freecycle1}, ..])</h3>

Allows reloaded Save games to be replayed in sync by reloading the released
units back into the queue they were in when a game was saved.
<dl>
<dt>MaxSlot</dt>
<dd>The total Number of slot used.</dd>
<dt>Slot</dt>
<dd>The Slot Number for the unit that was in the release Queue</dd>
<dt>FreecCycle</dt>
<dd>The Cycle that this unit is/was released in</dd>
</dl>

<h4>Example</h4>
<pre>
    SlotUsage(5, {2, 855})
</pre>

<hr>
All trademarks and copyrights on this page are owned by their respective owners.
<address>(c) 2002-2007 by <a href="http://boswars.org">
The Bos Wars Project</a></address></body></html>
